(window["webpackJsonpcreate-thunk"]=window["webpackJsonpcreate-thunk"]||[]).push([[0],{20:function(e,t,n){e.exports=n(32)},30:function(e,t,n){},32:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(9),o=n.n(c),u=n(4),i=n(1),l=n(19),s=(n(30),n(2));function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n={},r=function(e,r){var a=t+"/"+e;return n[a]=r,function(e){return{type:a,payload:e}}},a={configureAction:r,reducer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,r=arguments.length>1?arguments[1]:void 0,a=n[r.type];return a?a(r.payload)(t):t},update:r("UPDATE",function(e){return function(t){return p({},t,{},e)}})};return a},b=d({latency:500,shouldRequestsFail:!1},"DEBUG"),y=b.reducer,O=b.update,g=y,m=Object(i.b)(function(e){return{debug:e.debug}},function(e){return{update:function(t){return e(O(t))}}})(function(e){return a.a.createElement("div",{style:{background:"rgba(0, 0, 0, 0.6)",color:"white",padding:10}},a.a.createElement("h3",{style:{marginTop:0}},"Debug menu"),a.a.createElement("div",null,a.a.createElement("label",null,"Latency",a.a.createElement("input",{type:"number",value:e.debug.latency,onChange:function(t){return e.update({latency:Number(t.currentTarget.value)})}}))),a.a.createElement("div",null,a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",checked:e.debug.shouldRequestsFail,onChange:function(t){return e.update({shouldRequestsFail:t.currentTarget.checked})}}),"Make api requests fail")))}),v=n(8),h=n(13),w=n(3),j=n.n(w),E=n(6),S=n(10),P=n(11),D=(new Date(Date.now()-18e4).toISOString(),new Date(Date.now()-15e4).toISOString(),new Date(Date.now()-135e3).toISOString(),function(e){var t,n=["hey","hi","sup","yo","you up?"];return(t=n,Object(h.a)(t).sort(function(){return Math.random()-.5})).slice(0,Math.ceil(Math.random()*n.length)).map(function(t,n){return{id:String(n),text:t,sent:new Date(Date.now()-1e3*n).toISOString(),sender:"you",recipientId:e}})}),k=function(){return String(Math.random()).split(".").pop()},A=function(){function e(){Object(S.a)(this,e)}return Object(P.a)(e,null,[{key:"loadAll",value:function(){var e=Object(E.a)(j.a.mark(function e(t){var n,r;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.store.getState(),r=n.debug,e.next=3,new Promise(function(e){return setTimeout(e,r.latency)});case 3:if(!r.shouldRequestsFail){e.next=5;break}throw new Error("Simulated failure");case 5:return e.abrupt("return",D(t));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=Object(E.a)(j.a.mark(function e(t,n){var r,a,c;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=window.store.getState(),a=r.debug,e.next=3,new Promise(function(e){return setTimeout(e,a.latency)});case 3:if(!a.shouldRequestsFail){e.next=5;break}throw new Error("Simulated failure");case 5:return c={id:k(),text:n,sent:(new Date).toISOString(),sender:"you",recipientId:t},e.abrupt("return",c);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var I,T={loading:!1,error:null,lastUpdate:0,args:[]},_=(I=function(e,t){for(var n=e.start,r=e.done,a=e.fail,c=arguments.length,o=new Array(c>2?c-2:0),u=2;u<c;u++)o[u-2]=arguments[u];return function(){var e=Object(E.a)(j.a.mark(function e(c){var u,i,l,s;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(u=n())&&c(u),e.prev=2,e.next=5,t.apply(void 0,o);case 5:i=e.sent,(l=r(i))&&c(l),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),(s=a(e.t0))&&c(s);case 14:case"end":return e.stop()}},e,null,[[2,10]])}));return function(t){return e.apply(this,arguments)}}()},function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var c=C({},T,{args:r}),o=t.apply(void 0,r),u=function(){return c=C({},c,{loading:!0}),o(c)},i=function(e){return c=C({},c,{loading:!1,lastUpdate:Date.now()}),o(c,e)},l=function(e){return c=C({},c,{loading:!1,error:e}),o(c,void 0,e)};return I.apply(void 0,[{start:u,done:i,fail:l},e].concat(r))}});function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var M=function(e,t){if(!e[t])return e;var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e);return delete n[t],n},R=n(12);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var F,G,L={messages:[],loadAllState:T,sendStates:{}},B=(F="MESSAGES_BY_CHAT",G=d(L,"MESSAGE"),{configureAction:function(e,t){var n=G.configureAction(e,t);return function(e,t){return{type:F,payload:{key:e,action:n(t)}}}},reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(t.type===F){var n=t.payload.key;return p({},e,Object(s.a)({},n,G.reducer(e[n],t.payload.action)))}return e},update:function(e,t){return{type:F,payload:{key:e,action:G.update(t)}}}}),V=B.configureAction,H=B.update,J=B.reducer,X=V("APPEND_MESSAGE",function(e){return function(t){return q({},t,{messages:[].concat(Object(h.a)(t.messages),[e])})}}),Q=V("CANCEL_SEND_REQUEST",function(e){return function(t){return q({},t,{sendStates:M(t.sendStates,e)})}}),Y=V("UPDATE_SEND_STATES",function(e){return function(t){var n=t.sendStates,r=Object(v.a)(e.args,1)[0];return e.error||e.loading?q({},t,{sendStates:q({},n,Object(s.a)({},r.tempId,e))}):q({},t,{sendStates:M(n,r.tempId)})}}),z=_(A.loadAll,function(e){return function(t,n){return H(e,n?{loadAllState:t,messages:n}:{loadAllState:t})}}),K=_(function(e){var t=e.recipientId,n=e.text;return A.send(t,n)},function(e){var t=e.recipientId;return function(e,n){var r=[Y(t,e)];return n&&r.push(X(t,n)),Object(R.batchActions)(r)}}),W=Object(i.b)(function(e){return{recipientId:e.chat.activeChat}},function(e){return Object(u.b)({sendMessage:K},e)})(function(e){var t=Object(r.useState)(""),n=Object(v.a)(t,2),c=n[0],o=n[1];return a.a.createElement("form",{noValidate:!0,onSubmit:function(t){t.preventDefault(),t.currentTarget.checkValidity()&&e.recipientId&&(e.sendMessage({text:c,recipientId:e.recipientId,tempId:k()}),o(""))},style:{display:"flex",width:"100%"}},a.a.createElement("div",{style:{flexGrow:1}},a.a.createElement("input",{value:c,onChange:function(e){return o(e.currentTarget.value)},required:!0,className:"input"})),a.a.createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:10}},a.a.createElement("button",{className:"btn"},"Send")))}),Z=function(){var e=Object(i.e)(function(e){return e.chat.activeChat||""}),t=Object(i.e)(function(t){return t.recipient[e]||L}),n=Object(i.d)(),c=t.loadAllState;return Object(r.useEffect)(function(){var t,r,a,o=(t=z,a={state:c,maxAge:5e3},r=function(){if(a.state.error)return!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!Object(i.c)(t,a.state.args)||!a.state.loading&&(!a.state.lastUpdate||!!(a.maxAge&&a.state.lastUpdate&&Date.now()-a.state.lastUpdate>a.maxAge))},function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return function(e){if(r.apply(void 0,n))return e(t.apply(void 0,n))}});e&&!c.error&&n(o(e))},[n,e,c]),a.a.createElement(a.a.Fragment,null,a.a.createElement("ul",null,t.messages.map(function(e){return a.a.createElement("li",{key:e.id},e.text)})),a.a.createElement("ul",null,Object.keys(t.sendStates).map(function(e){var r=t.sendStates[e],c=Object(v.a)(r.args,1)[0];return a.a.createElement("li",{key:c.tempId,style:{opacity:r.loading?.5:1}},c.text,r.error&&a.a.createElement("div",null,a.a.createElement("span",{style:{color:"red"}},"Couldn't send"),a.a.createElement("button",{type:"button",className:"btn",onClick:function(){return n(K(c))}},"Retry?"),a.a.createElement("button",{type:"button",className:"btn",onClick:function(){return n(Q(c.recipientId,c.tempId))}},"Cancel")))})),t.loadAllState.loading&&a.a.createElement("span",null,"loading..."),t.loadAllState.error&&a.a.createElement("span",null,"An error occurred."," ",a.a.createElement("button",{className:"btn",onClick:function(){return n(z(e))}},"Retry?")))},$=[{id:"1",name:"Person 1"},{id:"2",name:"Person 2"},{id:"3",name:"Person 3, Person 4"}],ee=function(){function e(){Object(S.a)(this,e)}return Object(P.a)(e,null,[{key:"loadAll",value:function(){var e=Object(E.a)(j.a.mark(function e(){var t,n;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.store.getState(),n=t.debug,e.next=3,new Promise(function(e){return setTimeout(e,n.latency)});case 3:if(!n.shouldRequestsFail){e.next=5;break}throw new Error("Simulated failure");case 5:return e.abrupt("return",$);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}();function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var ne=d({activeChat:null,chats:[],loadChatsState:T},"CHAT"),re=ne.reducer,ae=ne.update,ce=re,oe=(0,ne.configureAction)("SET_ACTIVE_CHAT",function(e){return function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t,{activeChat:e})}}),ue=_(ee.loadAll,function(){return function(e,t){return ae(t?{loadChatsState:e,chats:t}:{loadChatsState:e})}}),ie=function(){var e=Object(i.e)(function(e){return e.chat}),t=e.chats,n=e.loadChatsState,c=e.activeChat,o=Object(i.d)();return Object(r.useEffect)(function(){o(ue())},[o]),Object(r.useEffect)(function(){!c&&t[0]&&o(oe(t[0].id))},[o,c,t]),n.loading?a.a.createElement("span",null,"Loading..."):a.a.createElement(a.a.Fragment,null,a.a.createElement("h1",null,"Chats"),a.a.createElement("ul",{className:"list-reset"},t.map(function(e){return a.a.createElement("li",{key:e.id},a.a.createElement("button",{type:"button",className:"btn btn-100 ".concat(c===e.id&&"btn-active"),onClick:function(){return o(oe(e.id))}},e.name))})))},le=function(){return a.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex"}},a.a.createElement("div",{style:{borderRight:"1px solid #999999",width:300}},a.a.createElement(ie,null)),a.a.createElement("div",{style:{flexGrow:1,display:"flex",flexDirection:"column"}},a.a.createElement("div",{style:{flexGrow:1}},a.a.createElement(Z,null)),a.a.createElement("div",{style:{padding:20}},a.a.createElement(W,null))),a.a.createElement("div",{style:{position:"fixed",top:0,right:20}},a.a.createElement(m,null)))},se=Object(R.enableBatching)(Object(u.c)({chat:ce,debug:g,recipient:J})),fe=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.d,pe=Object(u.e)(se,fe(Object(u.a)(l.a)));window.store=pe,o.a.render(a.a.createElement(i.a,{store:pe},a.a.createElement(le,null)),document.getElementById("root"))}},[[20,1,2]]]);
//# sourceMappingURL=main.669cad6e.chunk.js.map